<div class="container-fluid mt-3">

    <h2 class="text-primary">Danh sách Đơn hàng</h2>
    <ul class="list-group mt-3">
        <li class="list-group-item">
            <div class="form-group">
                <form id="city" class="mb-3" method="POST">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="supplier-name">Tên nhà cung cấp</label>
                                <input type="text" class="form-control form-control-sm focus" id="supplier-name"
                                    name="supplierName">
                            </div>
                            <div class="col-md-3">
                                <label for="supplier-phone-number">Số điện thoại</label>
                                <input type="text" class="form-control form-control-sm focus" id="supplier-phone-number"
                                    name="phoneNumber">
                            </div>
                            <div class="col-md-6">
                                <label for="supplier-address">Địa chỉ</label>
                                <input type="text" class="form-control form-control-sm focus" id="supplier-address"
                                    name="address">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <label for="supplier-district">Quận / Huyện</label>
                                <select class="form-control form-control-sm mr-sm-2" id="supplier-district"
                                    name="district">
                                    <option selected>Chọn Quận / Huyện...</option>
                                    {{#each districts}}
                                    <option value="{{this.district}}">{{this.district}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="supplier-cityprivince">Tỉnh / Thành phố</label>
                                <select class="form-control form-control-sm mr-sm-2" id="supplier-cityprivince"
                                    name="cityProvince">
                                    <option selected>Chọn Tỉnh / Thành phố...</option>
                                    {{#each cities}}
                                    <option value="{{this.cityprovince}}">{{this.cityprovince}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="col-md-6">
                                {{!-- <img src="..." alt="..." class="img-thumbnail">
                                <label for="supplier-img" class="btn btn-secondary">Chọn hình ảnh</label>
                                <input style="visibility:hidden;" type="file" class="form-control-file"
                                    placeholder="Chọn hình ảnh" id="supplier-img"> --}}
                                <label for="supplier-description">Mô tả</label>
                                <textarea class="form-control form-control-sm" id="supplier-description" rows="3"
                                    name="description"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
                <button type="button" id="test-clicked" class="btn btn-outline-primary btn-sm" data-target="#modal-add"
                    data-toggle="modal">Thêm mới</button>
            </div>
        </li>
    </ul>
</div>

<!-- Modal -->
<div class="modal fade" id="modal-add" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title text-light" id="exampleModalLabel">Tạo đơn hàng</h5>
                <button type="button" class="close  text-light" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <form id="add-bill" method="POST">
                            <div class="border-right">

                                <div class="row mr-2">
                                    <div class="col-md-3">
                                        <label for="bill-id">Mã HĐ</label>
                                        <input type="text" class="form-control form-control-sm focus" id="bill-id"
                                            name="billId">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="bill-name">Tên hóa đơn</label>
                                        <input type="text" class="form-control form-control-sm focus" id="bill-name"
                                            name="billName">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="customer-id">Mã KH</label>
                                        <input type="text" class="form-control form-control-sm focus" id="customer-id"
                                            name="customerId">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="customer-name">Tên khách hàng</label>
                                        <select class="form-control form-control-sm" id="customer-name"
                                            name="customerName">
                                            {{#each customers}}
                                            <option>{{this.customerName}}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>
                                <div class="row mr-2 mt-2">
                                    <div class="col-md-4">
                                        <label for="place-of-delivery">Địa chỉ giao hàng</label>
                                        <input type="text" class="form-control form-control-sm focus"
                                            id="place-of-delivery" name="placeOfDelivery">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="bill-payments">Hình thức thanh toán</label>
                                        <select class="form-control form-control-sm" id="bill-payments" name="payments">
                                            {{#each payments}}
                                            <option>{{this.title}}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="bill-transportation">Hình thức vận chuyển</label>
                                        <select class="form-control form-control-sm" id="bill-transportation"
                                            name="transportation">
                                            {{#each transportations}}
                                            <option>{{this.title}}</option>
                                            {{/each}}
                                        </select>
                                    </div>

                                </div>
                                <div class="mr-4 mt-2">
                                    <label for="bill-description">Mô tả</label>
                                    <textarea rows="2" type="text" class="form-control form-control-sm focus"
                                        id="bill-description" name="description"></textarea>
                                </div>
                                <div class="mt-3 mr-4">
                                    <table class="table table-hover table-sm" id="bill-table">
                                        <thead>
                                            <tr class="text-center">
                                                <th scope="col">#</th>
                                                <th scope="col">Mã sản phẩm</th>
                                                <th scope="col">Tên sản phẩm</th>
                                                <th scope="col">Loại sản phẩm</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each products}}
                                            <tr class="test-click text-center">
                                                <th scope="row">{{sum @index 1}}</th>
                                                <td><a href="/chi-tiet">{{this.productId}}</a></td>
                                                <td aria-valuetext="Ten san pham 1">{{this.productName}}</td>
                                                <td aria-valuetext="Ten san pham 1">{{this.productType}}</td>
                                                {{!-- <td class="text-center">
                                                    <a type="button" class="mr-4" data-toggle="modal"
                                                        data-id="{{this._id}}"
                                                        data-supplier-name="{{this.supplierName}}"
                                                        data-supplier-phone="{{this.phoneNumber}}"
                                                        data-supplier-address="{{this.address}}"
                                                        data-supplier-district="{{this.district}}"
                                                        data-supplier-cityprovince="{{this.cityProvince}}"
                                                        data-supplier-description="{{this.description}}"
                                                        data-target="#modal-edit">Sửa</a>
                                                    <a type="button" class="text-danger" data-toggle="modal"
                                                        data-id="{{this._id}}"
                                                        data-supplier-name="{{this.supplierName}}"
                                                        data-target="#modal-delete">
                                                        Xóa
                                                    </a>
                                                </td> --}}
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="exampleFormControlInput1">Sản phẩm</label>
                            <ul id="product-name" class="list-group san-pham-scroll">
                            </ul>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="create-new-bill">Tao moi</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Sửa</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <form id="edit-supplier" class="mb-3" method="POST">
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="supplier-name">Tên nhà cung cấp</label>
                                    <input type="text" class="form-control form-control-sm focus" id="supplier-name"
                                        name="supplierName">
                                </div>
                                <div class="col-md-3">
                                    <label for="supplier-phone-number">Số điện thoại</label>
                                    <input type="text" class="form-control form-control-sm focus"
                                        id="supplier-phone-number" name="phoneNumber">
                                </div>
                                <div class="col-md-6">
                                    <label for="supplier-address">Địa chỉ</label>
                                    <input type="text" class="form-control form-control-sm focus" id="supplier-address"
                                        name="address">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <label for="supplier-district">Quận / Huyện</label>
                                    <select class="form-control form-control-sm mr-sm-2" id="supplier-district"
                                        name="district">
                                        <option>Chọn Quận / Huyện...</option>
                                        {{#each districts}}
                                        <option value="{{this.district}}">{{this.district}}</option>
                                        {{/each}}
                                    </select>
                                    {{!-- <input type="text" class="form-control form-control-sm focus"
                                        id="supplier-district" name="district"></input> --}}
                                </div>
                                <div class="col-md-3">
                                    <label for="supplier-cityprovince">Tỉnh / Thành phố</label>
                                    <select class="form-control form-control-sm mr-sm-2" id="supplier-cityprovince"
                                        name="cityProvince">
                                        <option>Chọn Tỉnh / Thành phố...</option>
                                        {{#each cities}}
                                        <option value="{{this.cityprovince}}">{{this.cityprovince}}</option>
                                        {{/each}}
                                    </select>
                                    {{!-- <input type="text" class="form-control form-control-sm focus"
                                        id="supplier-cityprovince" name="cityProvince"></input> --}}
                                </div>
                                <div class="col-md-6">
                                    {{!-- <img src="..." alt="..." class="img-thumbnail">
                                    <label for="supplier-img" class="btn btn-secondary">Chọn hình ảnh</label>
                                    <input style="visibility:hidden;" type="file" class="form-control-file"
                                        placeholder="Chọn hình ảnh" id="supplier-img"> --}}
                                    <label for="supplier-description">Mô tả</label>
                                    <textarea class="form-control form-control-sm" id="supplier-description" rows="3"
                                        name="description"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="btn-edit-supplier" type="submit" class="btn btn-primary">Lưu lại</button>
                    <button type="submit" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <form name="delete-supplier" class="mt-3 mb-3 form-inline" method="POST"></form>

    <!-- Modal -->
    <div class="modal fade" id="modal-delete" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Xóa</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button id="btn-delete-supplier" type="submit" class="btn btn-danger">Có</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Không</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function (event) {
            var supplierId, supplier;
            var editSupplier = document.forms['edit-supplier'];
            var deleteSupplier = document.forms['delete-supplier'];
            var addBill = document.forms['add-bill'];
            var btnEditSupplier = document.getElementById('btn-edit-supplier');
            var btnDeleteSupplier = document.getElementById('btn-delete-supplier');
            var productName;
            var text;

            var btnCreateNewBill = document.getElementById('create-new-bill');
            console.log(btnCreateNewBill);
            btnCreateNewBill.onclick = function () {
                addBill.submit()
            }

            var addProduct = document.querySelector('#test-clicked');

            function addRowHandler(event) {
                var table = document.getElementById("bill-table");
                var rows = table.getElementsByTagName("tr");
                var arr = [];
                if (rows[1].innerText === 'No data available in table') {
                    event.preventDefault();
                } else {
                    for (i = 0; i < rows.length; i++) {
                        var currentRow = table.rows[i];
                        var createClickHandler = function (row) {
                            return function () {
                                var cell = row.getElementsByTagName("td")[1];
                                var value = cell.innerText;
                                var products = { productName: value }
                                arr.push(products)
                                console.log(arr);
                                var ul = document.getElementById('product-name');
                                console.log(ul)
                                var li = document.createElement('li')
                                for (e of arr) {
                                    console.log('e', e.productName)
                                    li.setAttribute('class', 'list-group-item');
                                    li.innerText = e.productName;
                                    ul.appendChild(li);
                                }
                            };
                        };
                        currentRow.onclick = createClickHandler(currentRow);

                    }

                }


            }

            addProduct.addEventListener('click', function (event) {
                addRowHandler(event);
            })


            $('#modal-edit').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                supplierId = button.data('id');
                supplierName = button.data('supplier-name');
                supplierPhone = button.data('supplier-phone');
                supplierAddress = button.data('supplier-address');
                supplierDistrict = button.data('supplier-district');
                supplierCityProvince = button.data('supplier-cityprovince');
                supplierDescription = button.data('supplier-description');
                var modal = $(this);
                modal.find('.modal-body #supplier-name').val(supplierName);
                modal.find('.modal-body #supplier-phone-number').val(supplierPhone);
                modal.find('.modal-body #supplier-address').val(supplierAddress);
                modal.find('.modal-body #supplier-district').val(supplierDistrict);
                modal.find('.modal-body #supplier-cityprovince').val(supplierCityProvince);
                modal.find('.modal-body #supplier-description').val(supplierDescription);
            })

            btnEditSupplier.onclick = function () {
                editSupplier.action = '/nha-cung-cap/' + supplierId + '?_method=PUT';
                editSupplier.submit();
            }

            $('#modal-delete').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                supplierId = button.data('id');
                supplierName = button.data('supplier-name');
                var modal = $(this);
                modal.find('.modal-body').text('Bạn có chắc muốn xóa nhà cung cấp ' + supplierName + ' ra khỏi danh sách không?');
            })

            btnDeleteSupplier.onclick = function () {
                deleteSupplier.action = '/nha-cung-cap/' + supplierId + '?_method=DELETE';
                deleteSupplier.submit();
            }

            $(document).ready(function () {
                $('#bill-table').DataTable();
            });
        })
    </script>